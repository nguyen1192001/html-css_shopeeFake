(("undefined"!=typeof self?self:this).webpackJsonp=("undefined"!=typeof self?self:this).webpackJsonp||[]).push([[224],{1149:function(e,t,a){"use strict";a.d(t,"a",function(){return s});var n=a(0),r=a(47),i=a.n(r);a(1259);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var s=function(e){var t,a;function r(t){var a;return(a=e.call(this,t)||this).onClick=function(e){e.preventDefault();var t=!a.state.checked;a.props.invalid||a.setState({checked:t});var n=a.props.onClick;"function"==typeof n&&n(t,e)},a.state={checked:!!t.checked},a}a=e,(t=r).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a;var i=r.prototype;return i.UNSAFE_componentWillReceiveProps=function(e){var t=e.checked;t!==this.props.checked&&t!==this.state.checked&&this.setState({checked:t||!1})},i.render=function(){return n.createElement(d,o({},this.props,{checked:this.state.checked,onClick:this.onClick}))},r}(n.Component);function c(){}function d(e){var t,a=e.checked,r=e.disabled,o=e.invalid,s=e.label,d=e.onClick,l=e.classnames,u=e.className,m=e.style;return n.createElement("label",{className:i()("stardust-checkbox",l,u,(t={},t["stardust-checkbox--disabled"]=r||o,t["stardust-checkbox--checked"]=a,t)),onClick:!r&&d?d:c,style:m},n.createElement("input",{className:"stardust-checkbox__input",type:"checkbox",onClick:c}),n.createElement("div",{className:"stardust-checkbox__box"}),s)}},1259:function(e,t,a){},1657:function(e,t,a){"use strict";a.d(t,"b",function(){return n.b}),a.d(t,"a",function(){return n.a}),a.d(t,"c",function(){return n.c}),a.d(t,"f",function(){return v}),a.d(t,"i",function(){return h}),a.d(t,"h",function(){return E}),a.d(t,"j",function(){return g}),a.d(t,"g",function(){return b}),a.d(t,"l",function(){return j}),a.d(t,"d",function(){return U}),a.d(t,"k",function(){return F}),a.d(t,"e",function(){return R});var n=a(440),r=a(3),i=a(137),o=a(976);function s(e,t,a,n,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void a(e)}s.done?t(c):Promise.resolve(c).then(n,r)}function c(e){return function(){var t=this,a=arguments;return new Promise(function(n,r){var i=e.apply(t,a);function o(e){s(i,n,r,o,c,"next",e)}function c(e){s(i,n,r,o,c,"throw",e)}o(void 0)})}}var d={REQUESTED:"FETCH_ADDON_DEAL_REQUESTED",SUCCESS:"FETCH_ADDON_DEAL_SUCCESS",FAILED:"FETCH_ADDON_DEAL_FAILED"},l={REQUESTED:"FETCH_ADDON_DEAL_SUBITEMS_REQUESTED",SUCCESS:"FETCH_ADDON_DEAL_SUBITEMS_SUCCESS",FAILED:"FETCH_ADDON_DEAL_SUBITEMS_FAILED"},u={REQUESTED:"FETCH_ADDON_DEAL_MAINITEMS_REQUESTED",SUCCESS:"FETCH_ADDON_DEAL_MAINITEMS_SUCCESS",FAILED:"FETCH_ADDON_DEAL_MAINITEMS_FAILED"},m={REQUESTED:"FETCH_ADDON_DEAL_ITEM_DETAILS_REQUESTED",SUCCESS:"FETCH_ADDON_DEAL_ITEM_DETAILS_SUCCESS",FAILED:"FETCH_ADDON_DEAL_ITEM_DETAILS_FAILED"},p={REQUESTED:"FETCH_ADDON_DEAL_CART_ITEMS_REQUESTED",SUCCESS:"FETCH_ADDON_DEAL_CART_ITEMS_SUCCESS",FAILED:"FETCH_ADDON_DEAL_CART_ITEMS_FAILED"},f={REQUESTED:"FETCH_PWG_CART_ITEMS_REQUESTED",SUCCESS:"FETCH_PWG_CART_ITEMS_SUCCESS",FAILED:"FETCH_PWG_CART_ITEMS_FAILED"},_={REQUESTED:"FETCH_ADDON_DEAL_SHOP_REQUESTED",SUCCESS:"FETCH_ADDON_DEAL_SHOP_SUCCESS",FAILED:"FETCH_ADDON_DEAL_SHOP_FAILED"};function v(e,t){var a=t&&t.actionType,i="mainItems"===a?u:"subItems"===a?l:d;return function(){var a=c(regeneratorRuntime.mark(function a(o){var s,c,d,l,u;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o({type:i.REQUESTED,options:t}),a.next=3,Object(r.jsonPost)(n.d,e);case 3:return(s=a.sent)&&(d=(c=s).error,l=c.error_msg,d||l?o({type:i.FAILED,error:d,error_msg:l,options:t}):(u=s.response)&&u.data&&o({type:i.SUCCESS,data:u.data,options:t})),a.abrupt("return",s);case 6:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()}function h(e){return function(){var t=c(regeneratorRuntime.mark(function t(a,n){var r,o,s,c,d,l,u,p,f,_,v,h,E,g;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.addOnDealStoreKey||"addOnDealCollection",o=n(),s=o&&o[r]&&o[r].data,c=s&&s.main_item_unprocessed,d=s&&s.main_items,l=e.offset,u=void 0===l?d.length:l,p=e.limit,a({type:m.REQUESTED}),f=c||[],t.next=10,i.a.fetchBatchProduct(f.slice(u,u+p).map(function(e){return{itemid:e.itemid,shopid:e.shopid}}));case 10:if(!(_=t.sent)){t.next=21;break}if(h=(v=_).error,E=v.error_msg,!h&&!E){t.next=17;break}a({type:m.FAILED,error:h,error_msg:E}),t.next=21;break;case 17:if(!(g=_.response)||!g.items){t.next=21;break}return a({type:m.SUCCESS,itemDetails:g.items,offset:u,limit:p}),t.abrupt("return");case 21:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()}function E(e,t){return function(){var a=c(regeneratorRuntime.mark(function a(i){var o,s,c,d,l;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i({type:p.REQUESTED}),a.next=3,Object(r.jsonPost)(n.e,{shoporders:e,need_price:t});case 3:if(!(o=a.sent)){a.next=16;break}if(s=o.error,c=o.error_msg,!s){a.next=10;break}i({type:p.FAILED,error:s,error_msg:c}),a.next=16;break;case 10:if(!o||!o.data){a.next=16;break}return d=[],(l=o.data&&o.data.shoporders)&&l.forEach(function(e){-1!==l.findIndex(function(t){return t.shopid===e.shopid})&&(d=d.concat(e.iteminfos))}),i({type:p.SUCCESS,data:d}),a.abrupt("return",d);case 16:return a.abrupt("return",o);case 17:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()}function g(e,t){return function(){var a=c(regeneratorRuntime.mark(function a(i){var o,s,c,d,l;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i({type:f.REQUESTED}),a.next=3,Object(r.jsonPost)(n.e,{shoporders:e,need_price:t});case 3:if(!(o=a.sent)){a.next=16;break}if(s=o.error,c=o.error_msg,!s){a.next=10;break}i({type:f.FAILED,error:s,error_msg:c}),a.next=16;break;case 10:if(!o||!o.data){a.next=16;break}return d=o.data.shoporders,l=[],e&&e.forEach(function(e){var t=d.find(function(t){return t.shopid===e.shopid});if(t&&t.iteminfos){var a=t.iteminfos.filter(function(t){return t.add_on_deal_id===e.add_on_deal_id});l=l.concat(a)}}),i({type:f.SUCCESS,pwgItems:l}),a.abrupt("return",l);case 16:return a.abrupt("return",o);case 17:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()}function b(e){return function(){var t=c(regeneratorRuntime.mark(function t(a){var n,r,i,s,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a({type:_.REQUESTED}),t.next=3,Object(o.e)(e);case 3:return(n=t.sent)&&(r=n.error,i=n.error_msg,r||i?a({type:_.FAILED,error:r,error_msg:i}):(s=n.response)&&s.data&&(s.data&&s.data&&(c=s.data),a({type:_.SUCCESS,data:c}))),t.abrupt("return",n);case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}var S=a(9);function I(e,t){var a;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(a=e[Symbol.iterator]()).next.bind(a)}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function C(){return(C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function y(e){return JSON.parse(JSON.stringify(e))}var D=function(e){if(!e)return null;var t=e.main_items,a=e.sub_items,n=e.item_details,r=A(t,a,n);return C({},e,{item_details:n,main_items:r.mainItems,main_item_unprocessed:t,sub_items:r.subItems,sub_items_raw:a})},A=function(e,t,a){var n={};a&&a.forEach(function(e){n[e.itemid]=e});var r=e.map(function(e){var t=n[e.itemid];if(t)return C({},y(t),{add_on_main_item:e})}).filter(function(e){return e&&!!e.name}),i=function(e,t){var a={},n=new Set;e.forEach(function(e){var r=e.itemid,i=e.modelid,o=e.status;t[r]&&t[r].stock>0&&1===t[r].status&&(n.add(r),i?(a[r]instanceof Set||(a[r]=new Set),1===o&&a[r].add(i)):delete a[r])});var r=[];return n.forEach(function(e){var n=a[e],i=e in t?y(t[e]):void 0;n&&i&&i.models&&i.models.forEach(function(e){n.has(e.modelid)||(e.stock=0)}),i&&i.models&&i.models.length>0&&0===i.models.filter(function(e){return e.stock>0}).length||i&&r.push(i)}),r}(t,n);return function(e,t){var a={};t.forEach(function(e){var t=e.itemid;t in a?a[t].push(e):a[t]=[e]}),e.forEach(function(e){var t=e.itemid;e.add_on_sub_items=a[t]})}(i,t),{mainItems:r,subItems:i}};function T(e,t){var a={};if(Array.isArray(e))for(var n,r=I(e);!(n=r()).done;){var i=n.value;i&&(a[i.itemid]=i)}if(Array.isArray(t))for(var o,s=I(t);!(o=s()).done;){var c=o.value;c&&(a[c.itemid]=c)}return Object.values(a)}function k(e,t){var a={};if(Array.isArray(e))for(var n,r=I(e);!(n=r()).done;){var i=n.value;i&&(a[i.itemid+":"+(i.modelid||"")]=i)}if(Array.isArray(t))for(var o,s=I(t);!(o=s()).done;){var c=o.value;c&&(a[c.itemid+":"+(c.modelid||"")]=c)}return Object.values(a)}function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var N={data:null,progress:S.b.INIT,itemDetailProgress:S.b.INIT,error:0,error_msg:""},w={data:null,pwgItems:[],progress:S.b.INIT,error:0,error_msg:""},P={data:null,progress:S.b.INIT,error:0,error_msg:""};function L(e,t,a){if(t>e.length){var n=t-e.length;e.splice.apply(e,[e.length,0].concat(new Array(n).fill(null)))}for(var r=arguments.length,i=new Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];return e.splice.apply(e,[t,a].concat(i)),e}function j(e,t){switch(void 0===e&&(e=N),t.type){case d.REQUESTED:return x({},e,{data:null,progress:S.b.REQ});case d.SUCCESS:return x({},e,{data:D(t.data),progress:S.b.OK});case d.FAILED:return x({},e,{progress:S.b.ERR,error:t.error,error_msg:t.error_msg});case u.SUCCESS:var a=e.data;if(!a)return e;var n=D(x({},a,{main_items:t.data.main_items,sub_items:a.sub_items_raw,item_details:T(a.item_details,t.data.item_details)}));return n?x({},e,{data:n}):e;case l.SUCCESS:var r=e.data;if(!r)return e;var i=D(x({},t.data,{main_items:r.main_item_unprocessed||[],sub_items:k(r.sub_items_raw,t.data.sub_items),item_details:T(t.data.item_details,r.item_details)}));return i?x({},e,{data:i}):e;case m.REQUESTED:return x({},e,{itemDetailProgress:S.b.REQ});case m.SUCCESS:var o=t.offset,s=t.limit,c=t.itemDetails,p=(e.data&&e.data.main_item_unprocessed?e.data.main_item_unprocessed:[]).slice(o,o+s);return x({},e,{data:x({},e.data,{main_items:[].concat(L.apply(void 0,[e.data&&e.data.main_items||[],o,s].concat(p.map(function(e){return x({},c.find(function(t){return t.itemid===e.itemid}),{add_on_main_item:e})}))))}),progress:S.b.OK,itemDetailProgress:S.b.OK});case m.FAILED:return x({},e,{progress:S.b.ERR,itemDetailProgress:S.b.ERR,error:t.error,error_msg:t.error_msg});default:return e}}function U(e,t){switch(void 0===e&&(e=w),t.type){case p.REQUESTED:return{data:e.data,pwgItems:e.pwgItems,progress:S.b.REQ,error:0,error_msg:""};case p.SUCCESS:return{data:t.data,pwgItems:t.pwgItems,progress:S.b.OK,error:0,error_msg:""};case p.FAILED:return{data:null,progress:S.b.ERR,error:t.error,error_msg:t.error_msg};default:return e}}function F(e,t){switch(void 0===e&&(e=w),t.type){case f.REQUESTED:return{pwgItems:e.pwgItems,progress:S.b.REQ,error:0,error_msg:""};case f.SUCCESS:return{pwgItems:t.pwgItems,progress:S.b.OK,error:0,error_msg:""};case f.FAILED:return{progress:S.b.ERR,error:t.error,error_msg:t.error_msg};default:return e}}function R(e,t){switch(void 0===e&&(e=P),t.type){case _.REQUESTED:return{data:null,progress:S.b.REQ,error:0,error_msg:""};case _.SUCCESS:return{data:t.data,progress:S.b.OK,error:0,error_msg:""};case _.FAILED:return{data:null,progress:S.b.ERR,error:t.error,error_msg:t.error_msg};default:return e}}},2299:function(e,t,a){"use strict";a.d(t,"a",function(){return s});var n=a(15),r=a(30),i=Object(n.c)(),o=Object(n.b)();function s(e,t){if(e&&100!==Math.abs(e))return"TW"===o&&i===r.a.TW.ChineseTrad||"MY"===o&&i===r.a.MY.ChineseSimp?function(e){return""+parseFloat(((100+e)/10).toFixed(1))}(e)+" "+t("aod_label_promotion_off"):e+"%"}},2608:function(e,t,a){e.exports={content:"qZNCeE",frame:"_3lvdbG",separator:"Y8f-hW",mainImage:"_2rubU7",giftImage:"_1U0tVc",nameSection:"_3F-cHj",itemWrapper:"_2-twlF",giftLabel:"_3iEyhI",mask:"_2Fep_-"}},3357:function(e,t,a){e.exports={itemCard:"_2uU5rH",itemSelectorGroup:"_3W03Ln",itemCheckedDisabled:"_2EK8B8",actualPrice:"VkoaE2",finalPrice:"m4QHaL",itemPrice:"_3-R9oQ",finalPriceOfficial:"_3Iw63I",itemQty:"_3IifUQ",itemImageWrapper:"_1gPDH8"}},3358:function(e,t,a){e.exports={popover:"_1E6klF",popoverSelector:"_28wnsP",popoverText:"jSM9Xc",arrow:"_2yANYx",rotateUp:"Cp0Jb8"}},3359:function(e,t,a){e.exports={popover:"SrhGvl",variationHeader:"_1dHpCd",variationOptions:"gdMVRb",variationSelectorGroup:"kOcWCx",qtyGroup:"_361jH6",qtyHeader:"_3a88Pm",buttonGroup:"_2abEcx",buttonSolid:"x1fdVV"}},3360:function(e,t,a){e.exports={options:"_3_g59U",optionLabels:"_1CG-cT",buttons:"K7susq"}},3361:function(e,t,a){e.exports={itemName:"_3u4tss",itemLink:"ctFDxG"}},3362:function(e,t,a){e.exports={addonInlineLabel:"_2PE-5m"}},3363:function(e,t,a){e.exports={itemImage:"_2BvI69",adultItemImage:"_1If6y8",itemImageWrapper:"ouNh1-",addOnLabel:"mV78tM",addOnLabelBgPrimary:"_2nXWsf",addOnLabelBgOfficial:"Mu1c2z",imageWrapper:"yzNZ5S"}},3364:function(e,t,a){e.exports={toastIcon:"Bq5xv7"}},3365:function(e,t,a){e.exports={addOnPriceFloatLeft:"vViM2D",addOnPriceTotalPriceGroup:"_2FdrcA",pricesSection:"_3kLFqX",addOnPricesOriginal:"_2W3Btt",labelSection:"_2U-nzc",columnDisplay:"_1gklPA",addOnPricesBottomMargin:"_1bnatd",totalPrices:"_1FYgML",labels:"_1eUbA6",addOnPricesAddOnDealSave:"BK4cc0",addOnPricesAddOnDealSaveOfficial:"_22QTTD",pricesSectionCol:"_1J79cc",addToCartButton:"_8bbvAu",addToCartButtonOfficial:"_1N-AK8",addToCartIcon:"_2VYkZ0"}},3366:function(e,t,a){e.exports={addToCartLabel:"E5L37W",addToCartLabelText:"kAGO7C",addToCartIcon:"_2xXtzn"}},3367:function(e,t,a){e.exports={seeMoreHeader:"_2nGD4z",seeMoreHeaderPrimary:"_3JfThe",arrow:"sxPaDw"}},3368:function(e,t,a){e.exports={addOnCards:"_3hKcfH",addOnLeft:"_2K2RzA",addOnHeader:"_3KQLsw",buyTogetherHeader:"_2F939U",addOnRight:"_2SfHtT",addOnItems:"ChFekK",addOnPlusIcon:"_29oUaz",addOnCardWrapper:"_308oBn"}},3369:function(e,t,a){e.exports={header:"_2Yk42U",headerTitle:"_2Qaoz1",buyMore:"M7O-kD",arrowIcon:"_3tUglM"}},3370:function(e,t,a){e.exports={link:"_3ZIR6v"}},3371:function(e,t,a){e.exports={section:"_3DhBR4",link:"_1B8iso"}},3901:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(47),o=a.n(i),s=a(53),c=a(76),d=a(268),l=a(88),u=a(958),m=function(e,t){var a=null,n=null;if(t){var r=p(e,t);r&&(n=r.price_before_discount||r.price);var i=f(e,t);a=i&&i.sub_item_price}else{n=e.price_before_discount||e.price;var o=e.add_on_sub_items[0];a=o&&o.sub_item_price}return{priceAddOnDeal:a,priceOriginal:n}},p=function(e,t){var a,n=e.models;if(n)for(var r=n.length,i=0;i<r;i++)if(n[i].modelid===t){a=n[i];break}return a},f=function(e,t){return e.add_on_sub_items.find(function(e){return e.modelid===t})},_=function(e,t){return e?e.find(function(e,a){if(t&&t.selectedVariation)return e.extinfo&&e.extinfo.tier_index&&e.extinfo.tier_index.length>0?e.extinfo.tier_index.length===t.selectedVariation.length&&e.extinfo.tier_index.every(function(e,a){return e===t.selectedVariation[a]}):a===t.selectedVariation[0]}):null},v=function(e,t){return(!e||!1!==e.isLoggedIn)&&(e&&e.isLoggedIn&&!!t&&t.shopid===e.shopid)},h=function(e,t,a){if(!e&&t){var n=Object(u.e)(t,__LOCALE__,{supportsGroupBuy:!1,selectedModel:a});return{price:n.priceBeforeDiscount,finalPrice:n.actualPrice}}return{price:null,finalPrice:null}},E=a(271),g=a(904),b=a(921),S=a(1963),I=a(3357),O=a.n(I),C=a(1149),y=a(54),D=a(3358),A=a.n(D),T=a(910),k=a(423),x=a(3359),N=a.n(x),w=a(1076),P=a(3360),L=a.n(P),j=a(1158);function U(e){var t=e.item,a=e.label,n=e.options,i=e.changeSelected,o=e.selectorValues,s=e.selectedOptions,c=e.thisTier;if(t&&n&&t.models){var d=Array.apply(null,Array(t.models.length));return t.models&&t.tier_variations&&t.tier_variations.length>0?d=Object(j.b)({itemModels:t.models,tierIndex:c,tierVariations:t.tier_variations,selectedOptionIndices:s.every(function(e){return null===e})?null:s}):t.models&&t.models.length>0&&(d=F(t.models,s)),r.a.createElement("div",{className:L.a.options},a&&r.a.createElement("div",{className:L.a.optionLabels},a),r.a.createElement("div",{className:L.a.buttons},n.map(function(e,t){var a=null===d[t];return r.a.createElement(w.a,{key:t,onClick:function(){a||i(o[0],o[1],t,d[t])},text:e,selected:!!d[t],disabled:a})})))}return null}var F=function(e,t){for(var a=[],n=0;n<e.length;n++){0===e[n].stock?a.push(null):t[0]===n?a.push(!0):a.push(!1)}return a},R=a(1142),M=a(119);var B=l.c.t;function Q(e){var t=e.item,a=e.changeSelected,n=e.itemState,i=e.changeSelectedQuantity,o=e.hideQuantity,s=void 0!==o&&o,c=e.applyChanges,d=e.cancelChanges,l=e.closePopover,u=function(e,t){var a=e.models&&e.models.find(function(e){return e.extinfo&&e.extinfo.tier_index&&e.extinfo.tier_index.join(",")===t.selectedVariation.join(",")}),n=e.stock;a&&(n=a.stock);var r=a&&e.add_on_sub_items&&e.add_on_sub_items.find(function(e){return e.modelid===a.modelid});return r&&(n=Math.min(n,r.sub_item_limit)),Math.max(n,1)}(t,n),m=[];if(t){var p=t.tier_variations;if(p&&p.length>0)for(var f=0;f<p.length;f++){var _=p[f];m.push(r.a.createElement("div",{key:f,className:N.a.variationOptions},r.a.createElement(U,{item:t,thisTier:f,label:p&&p.length>1?_.name:"",selectorValues:[t.itemid,f],options:_.options,changeSelected:a,selectedOptions:n.selectedVariation})))}else if(t.models&&t.models.length>0){var v=t.models;m.push(r.a.createElement("div",{key:m.length+1,className:N.a.variationOptions},r.a.createElement(U,{item:t,thisTier:0,label:"",selectorValues:[t.itemid,0],options:v.map(function(e){return e.name}),changeSelected:a,selectedOptions:n.selectedVariation})))}}return r.a.createElement("div",{className:N.a.popover},r.a.createElement("div",{className:N.a.variationHeader},B("aod_label_variations")),r.a.createElement("div",{className:N.a.variationSelectorGroup},m,!s&&r.a.createElement("div",{className:N.a.qtyGroup},r.a.createElement("div",{className:N.a.qtyHeader},B("aod_label_quantity")),r.a.createElement(R.a,{quantity:n.quantity,onIncrease:function(){i&&i(t.itemid,Math.min(n.quantity+1,u))},onDecrease:function(){i&&i(t.itemid,n.quantity-1)},onChange:function(e){var a=e.target.value;if(i)if(""===a)i(t.itemid,a);else{var n=parseInt(a,10);i(t.itemid,Math.min(n,u))}},onBlur:function(){}}))),r.a.createElement("div",{className:N.a.buttonGroup},r.a.createElement(M.e,{label:B("aod_button_cancel"),onClick:function(){d(t.itemid),l()}}),r.a.createElement(M.d,{classnames:[N.a.buttonSolid],onClick:function(){c(t.itemid),l()},modifiers:["primary"],disabled:n&&n.selectedVariation&&n.selectedVariation.includes(null)},B("aod_button_confirm"))))}var H=function(e){var t,a;function r(t){var a;return(a=e.call(this,t)||this).openPopover=function(){a.setState({displayPopover:!0})},a.closePopover=function(){a.setState({displayPopover:!1})},a.state={displayPopover:!1},a}return a=e,(t=r).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a,r.prototype.render=function(){var e=this,t=this.props,a=t.item,r=t.changeSelected,i=t.itemState,s=t.changeSelectedQuantity,c=t.applyChanges,d=t.cancelChanges,l=t.selectedModel,u=t.trackingClick;return n.createElement("div",{className:A.a.select},n.createElement(T.b,{className:A.a.popover,popover:n.createElement(Q,{itemState:i,changeSelected:r,changeSelectedQuantity:s,item:a,applyChanges:c,cancelChanges:d,closePopover:this.closePopover}),open:this.state.displayPopover,target:n.createElement("div",{className:A.a.popoverSelector,onClick:function(){u(),e.state.displayPopover?(d(a.itemid),e.closePopover()):e.openPopover()}},n.createElement("div",{className:A.a.popoverText},l?l.name:""),n.createElement("div",{className:o()(A.a.arrow,this.state.displayPopover&&A.a.rotateUp)})),position:T.a.BOTTOM_LEFT,margin:10,onClickOutside:function(){d(a.itemid),e.closePopover()},showArrow:!0,showBorder:!0,arrowBackgroundColor:"white"}))},r}(n.Component),q=Object(k.a)(H,"AddOnSelect"),G=a(3361),V=a.n(G),W=a(328),K=a(392),z=a(3362),J=a.n(z);function Y(e){return e.toDisplay?r.a.createElement("span",{className:J.a.addonInlineLabel},e.toDisplay):null}var X=a(409),Z=l.c.t;var $=Object(X.a)(function(e){var t=e.item,a=e.isSubItem,r=e.isGift,i=e.trackingRef,o=e.trackingClick;return n.createElement("div",{ref:i},n.createElement(K.a,{onClick:o,to:W.b.getUrl({seoName:t.name,shopId:t.shopid,itemId:t.itemid}),className:V.a.itemLink},n.createElement("div",{className:V.a.itemName},r?n.createElement(Y,{toDisplay:Z("aod_label_gift")}):a?n.createElement(Y,{toDisplay:Z("aod_label_add_on")}):null,t.name)))},"AddOnItemName"),ee=a(3363),te=a.n(ee),ae=a(898),ne=a(2299),re=l.c.t;var ie=Object(X.a)(function(e){var t,a=e.item,r=e.trackingClick,i=e.trackingRef,s=e.isAdult,c=e.imageUrl,d=e.priceAddOnDeal,l=e.priceOriginal;d&&l&&(t=(d-l)/l*100,t=Math.round(t));var u=Object(ne.a)(t,re);return n.createElement("div",{className:te.a.imageWrapper,ref:i},n.createElement(K.a,{onClick:r,to:W.b.getUrl({seoName:a.name,shopId:a.shopid,itemId:a.itemid})},n.createElement(ae.a,{className:o()(te.a.itemImage,s&&te.a.adultItemImage),wrapperClassName:o()(te.a.itemImageWrapper),isCovered:!s,src:c}),!!u&&n.createElement("div",{className:o()(te.a.addOnLabel,a.is_official_shop?te.a.addOnLabelBgOfficial:te.a.addOnLabelBgPrimary)},u)))},"AddOnItemImage"),oe=a(419),se=a(2008),ce=se.a,de=a(1301)("./"+ce+"-plus.png");var le=function(e){var t=n.useContext(oe.a).userAdult.isUserAdult,a=e.item,r=e.addOnDealsSubItems,i=e.isSubItem,s=void 0===i||i,c=e.checkDisabled,d=e.changeSelected,l=e.changeChecked,u=e.changeSelectedQuantity,p=e.itemState,f=e.prevItemState,g=e.applyChanges,b=e.cancelChanges,S=e.userAccount,I=e.location;if(!a)return null;var D=a.is_adult&&!t&&!v(S,a),A=D?de:Object(y.e)(a.image,!0),T=1,k=null,x=a.models;x&&f&&(k=_(x,f),T=f.quantity);var N,w=function(e,t){return Boolean(e&&e[0]&&e[0].name&&t)}(x,k),P=h(s,a,k),L=P.price,j=P.finalPrice;if(r&&s){var U=k?k.modelid:void 0;N=m(a,U),L=Object(E.h)(N.priceOriginal),j=Object(E.h)(N.priceAddOnDeal)}return n.createElement("div",{className:O.a.itemCard},n.createElement("div",{className:O.a.itemImageWrapper},n.createElement(ie,{isAdult:D,item:a,imageUrl:A,location:I,priceAddOnDeal:N&&N.priceAddOnDeal,priceOriginal:N&&N.priceOriginal}),T>1&&n.createElement("div",{className:O.a.itemQty},T)),n.createElement($,{item:a,isSubItem:s,isGift:N&&0===N.priceAddOnDeal,location:I}),n.createElement("div",{className:O.a.itemSelectorGroup},n.createElement(C.a,{classnames:o()(c&&O.a.itemCheckedDisabled),checked:p&&p.selected,onClick:function(){c||l(a.itemid)}}),w&&n.createElement(q,{item:a,location:I,changeSelected:d,changeSelectedQuantity:u,itemState:p,applyChanges:g,cancelChanges:b,selectedModel:k})),n.createElement("div",{className:O.a.itemPrice},L&&n.createElement("span",{className:O.a.actualPrice},L),n.createElement("span",{className:o()(O.a.finalPrice,a.is_official_shop&&O.a.finalPriceOfficial)},j)))},ue=a(3364),me=a.n(ue),pe=a(1059),fe=a(447);function _e(e){return r.a.createElement(pe.a,{toastIcon:r.a.createElement("div",{className:me.a.toastIcon},r.a.createElement(fe.a,null)),toastText:e.toastText,showToast:e.showToast,onToastDismiss:e.onToastDismiss,duration:3e3})}var ve=a(3365),he=a.n(ve),Ee=a(3366),ge=a.n(Ee),be=a(1171),Se=l.c.t;var Ie=Object(k.a)(function(e){var t=e.trackingClick;return n.createElement("div",{className:ge.a.addToCartLabel,onClick:t},n.createElement(be.a,{classNames:ge.a.addToCartIcon}),n.createElement("div",{className:ge.a.addToCartLabelText},Se("aod_button_add_to_cart")))},"AddOnAddToCartButtonLabel"),Oe=l.c.t;var Ce=function(e){var t=e.totalPrices,a=e.isOfficial,n=e.isSellerOfProduct,i=e.requireUserToLogin,s=e.shopInfo,c=e.item,d=e.userAccount,l=e.addOnDealsData,u=e.parentState,m=e.addSelectedItemsToCart,p=e.showSemiInactive,f=e.showInactive;if(!t)return null;var _=t.pricesOriginal&&Object(E.f)(t.pricesOriginal),v=Object(E.f)(t.pricesAddOnDeal),h=t.pricesOriginal&&Object(E.f)(t.pricesOriginal-t.pricesAddOnDeal)||Object(E.f)(0);return r.a.createElement("div",{className:he.a.addOnPriceTotalPriceGroup},r.a.createElement("div",{className:he.a.addOnPriceFloatLeft},r.a.createElement("div",{className:he.a.pricesSection},r.a.createElement("div",{className:he.a.columnDisplay},r.a.createElement("div",{className:o()(he.a.labels,he.a.addOnPricesBottomMargin)},Oe("aod_label_total_price")),r.a.createElement("div",{className:o()(he.a.labels,he.a.addOnPricesAddOnDealSave,a&&he.a.addOnPricesAddOnDealSaveOfficial)},Oe("aod_label_saved_price"))),r.a.createElement("div",{className:o()(he.a.columnDisplay,he.a.pricesSectionCol)},r.a.createElement("div",{className:o()(he.a.addOnPricesBottomMargin,he.a.totalPrices)},_&&r.a.createElement("div",{className:he.a.addOnPricesOriginal},_),r.a.createElement("div",null,v)),r.a.createElement("div",{className:o()(he.a.addOnPricesAddOnDealSave,a&&he.a.addOnPricesAddOnDealSaveOfficial)},h)))),r.a.createElement("div",null,!n&&r.a.createElement(M.b,{classnames:[he.a.addToCartButton,a&&he.a.addToCartButtonOfficial],onClick:function(){if(!c)return null;var e=!!s&&s.last_active_time||0;return Object(S.c)(e)?(f(),null):Object(S.d)(e)?(p(),null):void(d&&d.isLoggedIn?m():i())},modifiers:["primary"]},r.a.createElement(Ie,{parentState:u,mainItem:c,subItemLimit:l.sub_item_limit}))))},ye=a(1098),De=a(1858),Ae=a(413),Te=a(3367),ke=a.n(Te),xe=l.c.t;var Ne=Object(k.a)(function(e){var t=e.isOfficial,a=e.item,r=e.trackingClick;return n.createElement(K.a,{className:o()(!t&&ke.a.seeMoreHeader,t&&ke.a.seeMoreHeaderPrimary),to:a&&a.add_on_deal_info?Object(De.m)(a.add_on_deal_info.add_on_deal_id,a.itemid,a.shopid):"/",onClick:r},xe("aod_button_view_more"),n.createElement(Ae.a,{className:ke.a.arrow}))},"AddOnSeeMoreLink"),we=a(109),Pe=a(1361),Le=a(1657),je=1,Ue=2,Fe=a(113),Re=a(272),Me=a(584),Be=a(325),Qe=a(3368),He=a.n(Qe);function qe(e,t,a,n,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void a(e)}s.done?t(c):Promise.resolve(c).then(n,r)}function Ge(e){return function(){var t=this,a=arguments;return new Promise(function(n,r){var i=e.apply(t,a);function o(e){qe(i,n,r,o,s,"next",e)}function s(e){qe(i,n,r,o,s,"throw",e)}o(void 0)})}}function Ve(e,t){var a;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return We(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return We(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(a=e[Symbol.iterator]()).next.bind(a)}function We(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function Ke(){return(Ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var ze={pricesAddOnDeal:0,pricesOriginal:0},Je=l.c.t,Ye=function(e){var t,a;function r(t){var a;return(a=e.call(this,t)||this).changeSelected=function(e,t,n,r){var i,o=[].concat(a.state[e].selectedVariation);o[t]=null,r||(o[t]=n),a.setState(((i={})[e]=Ke({},a.state[e],{selectedVariation:o}),i))},a.changeSelectedQuantity=function(e,t){var n,r=a.getItemFromId(e),i=Math.min(t,r?r.stock:0);a.setState(((n={})[e]=Ke({},a.state[e],{quantity:i>0?i:1}),n))},a.applyChanges=function(e){var t,n,r=a.props,i=r.updatedMainItem,o=r.addOnDealsSubItems,s=$e(i,Ke({},a.state.prevItemStates,((t={})[e]=a.state[e],t)),o);a.setState({prevItemStates:Ke({},a.state.prevItemStates,(n={},n[e]=a.state[e],n)),totalPrices:s,shouldFetchCart:!0})},a.cancelChanges=function(e){var t;a.state.prevItemStates&&a.setState(((t={})[e]=a.state.prevItemStates[e],t))},a.getItemFromId=function(e){return a.props.item&&a.props.item.itemid===e?a.props.item:a.props.addOnDealsSubItems&&a.props.addOnDealsSubItems.find(function(t){return t.itemid===e})},a.changeChecked=function(e){var t,n,r;a.setState(((r={})[e]=Ke({},a.state[e],{selected:!a.state[e].selected}),r.prevItemStates=Ke({},a.state.prevItemStates,((t={})[e]=Ke({},a.state[e],{selected:!a.state[e].selected}),t)),r.totalPrices=$e(a.props.updatedMainItem,Ke({},a.state.prevItemStates,((n={})[e]=Ke({},a.state[e],{selected:!a.state[e].selected}),n)),a.props.addOnDealsSubItems),r))},a.hideSemiInactive=function(){a.setState({showSemiInactive:!1})},a.showSemiInactive=function(){a.setState({showSemiInactive:!0})},a.hideInactive=function(){a.setState({showInactive:!1})},a.showInactive=function(){a.setState({showInactive:!0})},a.showAddonToast=function(){a.setState({showAddonToast:!0})},a.hideAddonToast=function(){a.setState({showAddonToast:!1})},a.countSelectedItems=function(e,t){for(var a,n=0,r=Ve(e);!(a=r()).done;){var i=a.value;i.itemId!==t&&(n+=1*i.quantity)}return n},a.getSelectedItems=function(e,t,n,r){return e&&r&&n?e.map(function(e){var i=parseInt(e.key,10)===a.props.item.itemid?a.props.item:r.find(function(t){return parseInt(e.key,10)===t.itemid});if(i&&t){var o=n&&a.state.prevItemStates&&a.state.prevItemStates[i.itemid],s=o&&i.models?_(i.models,o):null,c=null;return o&&r&&(c=et(i,o,i.itemid===n.itemid)),{shopId:i.shopid,itemId:i.itemid,quantity:e.quantity,modelId:s?s.modelid:null,add_on_deal_id:t,is_add_on_sub_item:n.itemid!==i.itemid,price:c?c.priceAddOnDeal||c.priceOriginal:0}}}).filter(Boolean):[]},a.isAddonDealInvalid=function(e,t,a,n){return!e||t&&!t.add_on_deal_info||n&&1!==n.status||!a},a.state={showSemiInactive:!1,showInactive:!1,hasItem:!1,hasSubItemList:!1,showAddonToast:!1,totalPrices:ze,mainItemId:void 0,shouldFetchCart:!0},a.addSelectedItemsToCart=a.addSelectedItemsToCart.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a)),a}a=e,(t=r).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a;var i=r.prototype;return i.componentDidMount=function(){var e=this.props.injectAsyncReducer;"function"==typeof e&&e({addOnDeals:Le.l,addOnCartItems:Le.d})},r.getDerivedStateFromProps=function(e,t){var a;if(e.item&&t.mainItemId!==e.item.itemid)return{showSemiInactive:!1,showInactive:!1,hasItem:!1,hasSubItemList:!1,showAddonToast:!1,totalPrices:ze,mainItemId:e.item&&e.item.itemid||-1};if(!t.hasItem&&e.item&&e.item.add_on_deal_info)return r.setInitialItemState(e);if(!t.hasSubItemList&&e.addOnDealsSubItems)return r.setSubItemsItemState(e,t);var n=e.updatedMainItem,i=e.addOnDealsSubItems,o=$e(n,Ke({},t.prevItemStates,((a={})[e.item.itemid]=t[e.item.itemid],a)),i),s=t.totalPrices;return o&&s&&(o.pricesAddOnDeal!==s.pricesAddOnDeal||o.pricesOriginal!==s.pricesOriginal)?{totalPrices:o}:t.shouldFetchCart?(r.fetchCartAndAddon(e,t),Ke({},t,{shouldFetchCart:!1})):e.addOnDealsSubItems&&e.addOnDealsSubItems.map(function(e){return e.itemid}).every(function(e){return!t[e]})?r.setSubItemsItemState(e,t):null},i.addSelectedItemsToCart=function(){var e=Ge(regeneratorRuntime.mark(function e(){var t,a,n,r,i,o,s,c,d,l,u=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,a=t.item,n=t.addItemToCartBatch,r=t.addOnDealsSubItems,i=t.addOnDealsData,o=t.ENABLE_CART_V4,s=[],c=a&&a.add_on_deal_info&&a.add_on_deal_info.add_on_deal_id,Object.keys(this.state).forEach(function(e){s.push(Ke({key:e},u.state[parseInt(e,10)]))}),d=s.filter(function(e){return e.selected}),l=this.getSelectedItems(d,c,a,r),!(this.countSelectedItems(l,a.itemid)>i.sub_item_limit)){e.next=11;break}return Object(Me.a)({action:"ProductPage.action_reach_limit",track:this.props.contextOnTrack,data:{itemid:a.itemid,shopid:a.shopid,reach_limit_status:4}}),this.showAddonToast(),e.abrupt("return",null);case 11:return e.next=13,n({items:l,options:{onSuccess:function(){for(var e,t=Ve(l);!(e=t()).done;){var a=e.value,n=a.itemId,r=a.shopId,i=a.quantity,o=a.price,s=a.modelId;Object(Me.a)({action:"ProductPage.action_add_to_cart_success",track:u.props.contextOnTrack,data:{itemid:n,shopid:r,modelid:s,price:o,quantity:i,is_main_item:n===u.props.item.itemid}})}u.props.fetchCartDrawerItems()}},useBFFEndpoint:o});case 13:e.sent.error&&window.location.reload();case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),i.render=function(){var e=this,t=this.props,a=t.item,r=t.addOnDealsSubItems,i=t.userAccount,s=t.requireUserToLogin,c=t.ENABLE_ADDON_DEAL,d=t.shopInfo,l=t.addOnDealsData,u=t.updatedMainItem||a,m=this.state.totalPrices;if(this.isAddonDealInvalid(c,a,r,l))return null;var p=r||[];if(p.length<1)return null;var f=a&&a.is_official_shop,_=a&&this.state[a.itemid],h=a&&this.state.prevItemStates&&this.state.prevItemStates[a.itemid],E=v(i,a);return n.createElement("div",{className:He.a.addOnCards},n.createElement("div",{className:He.a.addOnLeft},n.createElement("div",{className:He.a.addOnHeader},n.createElement("div",{className:He.a.buyTogetherHeader},Je("aod_label_add_on_deals")),p&&n.createElement(Ne,{isOfficial:f,item:a})),n.createElement("div",{className:He.a.addOnItems},n.createElement(le,{key:0,location:0,addOnDealsSubItems:r,itemState:_,prevItemState:h,changeSelected:this.changeSelected,changeSelectedQuantity:this.changeSelectedQuantity,changeChecked:this.changeChecked,applyChanges:this.applyChanges,cancelChanges:this.cancelChanges,item:u,checkDisabled:!0,isSubItem:!1,userAccount:i}),n.createElement("div",{className:He.a.addOnPlusIcon},n.createElement(ye.a,null)),p&&p.slice(0,1===l.sub_item_limit?l.sub_item_limit:4).map(function(t,a){return t&&n.createElement("div",{key:a+1,className:o()(a>0&&He.a.addOnCardWrapper)},n.createElement(le,{location:a+1,itemState:t&&e.state[t.itemid],addOnDealsSubItems:r,prevItemState:t&&e.state.prevItemStates&&e.state.prevItemStates[t.itemid],changeSelected:e.changeSelected,changeSelectedQuantity:e.changeSelectedQuantity,changeChecked:e.changeChecked,applyChanges:e.applyChanges,cancelChanges:e.cancelChanges,item:t,checkDisabled:!1,userAccount:i}))}))),n.createElement("div",{className:He.a.addOnRight},n.createElement(Ce,{totalPrices:m,isOfficial:f,isSellerOfProduct:E,item:a,shopInfo:d,userAccount:i,requireUserToLogin:s,addOnDealsData:l,parentState:this.state,addSelectedItemsToCart:this.addSelectedItemsToCart,showSemiInactive:this.showSemiInactive,showInactive:this.showInactive})),n.createElement(Pe.a,{isOpen:this.state.showSemiInactive},n.createElement(we.a,{primaryBtnText:Je("aod_button_add_to_cart"),onPrimaryBtnClick:this.addSelectedItemsToCart,complementBtnText:Je("product_page_label_chat_to_offer"),onComplementBtnClick:this.props.chatWithShop,message:""+Je("product_page_msg_inactive_sellers_popup",{n:S.b}),onClose:this.hideSemiInactive})),n.createElement(Pe.a,{isOpen:this.state.showInactive},n.createElement(we.a,{primaryBtnText:Je("product_page_label_chat_to_offer"),onPrimaryBtnClick:this.props.chatWithShop,complementBtnText:Je("aod_button_cancel"),onComplementBtnClick:function(){},message:""+Je("product_page_msg_real_inactive_sellers_popup",{n:S.a}),onClose:this.hideInactive})),n.createElement(_e,{toastText:Je("aod_alert_add_item_limit",{count:l.sub_item_limit}),showToast:this.state.showAddonToast,onToastDismiss:this.hideAddonToast}))},r}(n.Component);Ye.fetchCartAndAddon=function(){var e=Ge(regeneratorRuntime.mark(function e(t,a){var n,r,i,o,s,c,d,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fetchAddonCartV4,r=t.fetchAddOnDeal,i=t.item,o=i.shopid,s=i.itemid,c=i&&i.add_on_deal_info&&i.add_on_deal_info.add_on_deal_id||0,e.next=7,n([{shopid:o,add_on_deal_id:c}],!1);case 7:d=e.sent,l=Ye.combineCartAndSelectedMainItems(t,a,d),r({add_on_deal_id:c,main_itemids:[s],need_item_info:!0,main_item_infos:l,price_type:Le.c.PDP},{actionType:"mainItems"});case 10:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),Ye.combineCartAndSelectedMainItems=function(e,t,a){var n=t.prevItemStates,r=e.item,i=n&&n[r.itemid],o=i&&r.models?(_(r.models,i)||{}).modelid:0,s=i?i.quantity:0,c=Array.isArray(a)&&a.find(function(e){return e.itemid===r.itemid&&e.modelid===o}),d=c?c.quantity:0;return[{item_id:r.itemid,models:[{model_id:o,purchase_quantity:s+d}]}]},Ye.setInitialItemState=function(e){var t=[],a={},n={add_on_deal_id:e.item&&e.item.add_on_deal_info&&e.item.add_on_deal_info.add_on_deal_id||0,need_item_info:!0,main_itemids:[e.item&&e.item.itemid||0]};e.fetchAddOnDeal(n);for(var r=e.item&&e.item.models||[],i=0;i<r.length;i++){var o=r[i];if(o&&o.stock>0){t=o&&o.extinfo&&o.extinfo.tier_index&&o.extinfo.tier_index.length&&o.extinfo.tier_index||[i];break}}return t&&t.length>0?a[e.item.itemid]={selectedVariation:t,selected:!0,quantity:1}:a[e.item.itemid]={selected:!0,quantity:1},Ke({},a,{prevItemStates:Ke({},a),hasItem:!0,totalPrices:$e(e.updatedMainItem,Ke({},a),e.addOnDealsSubItems),mainItemId:e.item.itemid||-1})},Ye.setSubItemsItemState=function(e,t){var a=e.addOnDealsSubItems,n=e.item,r=e.addOnDealsData;if(a&&n){var i,o=a.map(function(e){var t,a=[],n=e.add_on_sub_items,r=e&&e.models;if(r)for(var i=function(e){var t=r[e];if(t&&t.stock>0&&-1!==n.findIndex(function(e){return e.modelid===t.modelid}))return a=a=t&&t.extinfo&&t.extinfo.tier_index&&t.extinfo.tier_index.length&&t.extinfo.tier_index||[e],"break"},o=0;o<r.length;o++){if("break"===i(o))break}return e&&((t={})[e.itemid]={selected:!0,quantity:1,selectedVariation:a},t)}),s=Object.assign.apply(Object,[{}].concat(o.slice(0,1===r.sub_item_limit?r.sub_item_limit:4)));return Ke({hasSubItemList:!0},s,((i={})[e.item.itemid]=t[e.item.itemid],i.prevItemStates=Ke({},s,t.prevItemStates),i.totalPrices=$e(e.updatedMainItem,Ke({},s,t.prevItemStates),e.addOnDealsSubItems),i))}return{}};var Xe={fetchAddOnDeal:Le.f,addItemToCartBatch:Fe.e,fetchAddonCartV4:Le.h,fetchCartDrawerItems:Re.a},Ze=Object(s.d)(Object(Be.a)(),Object(c.connect)(function(e,t){var a=e&&e.addOnDeals&&e.addOnDeals.data,n=a&&a.sub_items,r=Object(b.isFeatureEnabledForUser)(e.featureToggles,g.a),i=Object(b.isFeatureEnabledForUser)(e.featureToggles,g.d),o=a||{},s=o.start_time,c=o.end_time,d=o.status,l=o.sub_item_limit,u=e.addOnCartItems;return{addOnDealsSubItems:n,ENABLE_ADDON_DEAL:r,ENABLE_CART_V4:i,addOnDealsData:{start_time:s,end_time:c,status:d,sub_item_limit:l},cartItems:(void 0===u?{}:u).data,updatedMainItem:a&&a.item_details&&a.item_details.find(function(e){return e.itemid===t.item.itemid})}},Xe),d.c)(Ye),$e=function(e,t,a){var n=[];if(t&&a){var r=function(r){var i=parseInt(r,10);if(t[i]&&t[i].selected){var o=a&&a.find(function(e){return e.itemid===i});e&&i!==e.itemid&&o?n.push(et(o,t[i],!1)):e&&i===e.itemid&&n.push(et(e,t[i],!0))}};for(var i in t)r(i);for(var o,s=0,c=0,d=Ve(n);!(o=d()).done;){var l=o.value,u=l&&l.finalPrice||0,m=l&&l.price||u;s+=Object(E.e)(u)*l.qty,c+=Object(E.e)(m)*l.qty,s+=l&&l.priceAddOnDeal?l.qty*Object(E.e)(l.priceAddOnDeal):0,c+=l&&l.priceOriginal?l.qty*Object(E.e)(l.priceOriginal):0}return c===s&&(c=null),{pricesAddOnDeal:s,pricesOriginal:c}}return ze},et=function(e,t,a){if(void 0===a&&(a=!1),e.models){var n=_(e.models,t),r=n?n.modelid:void 0;return Ke({qty:t.quantity},a?function(e,t){var a=Object(u.e)(e,__LOCALE__,{supportsGroupBuy:!1,selectedModel:t,customFormatPrice:function(e){return String(e)}}),n=a.priceBeforeDiscount,r=a.actualPrice;return{price:Number(n),finalPrice:Number(r)}}(e,n):m(e,r))}return{qty:0}},tt=a(1339),at=a(3369),nt=a.n(at),rt=l.c.t,it=Object(k.a)(function(e){var t=e.minSpend,a=e.giftCount,r=e.trackingClick,i=Object(E.h)(t);return n.createElement("div",{className:nt.a.header,onClick:r},n.createElement("div",{className:nt.a.headerTitle},rt("product_page_label_pwg_spend_to_get_gift",{price:i,giftCount:a})),n.createElement("div",{className:nt.a.buyMore},n.createElement("span",null,rt("product_page_label_pwg_buy_more")),n.createElement(tt.a,{className:nt.a.arrowIcon})))},"PurchaseWithGiftHeader"),ot=a(2608),st=a.n(ot),ct=l.c.t,dt=function(e,t){switch(e){case je:return"+ "+ct("label_pwg_more_items",{count:t});case Ue:return"+ "+ct("label_pwg_more_gifts",{count:t});default:return""}},lt=function(e){return n.createElement("div",{className:st.a.mask},e)},ut=Object(X.a)(function(e){var t=e.cardType,a=e.image,r=e.name,i=e.isMasked,o=e.itemCounts,s=e.trackingClick,c=n.useCallback(function(e){e.stopPropagation(),s()},[s]);return n.createElement("div",{onClick:c,className:st.a.itemWrapper},n.createElement(ae.a,{key:a,src:a,className:st.a.mainImage,useImgTag:!0},i&&lt(dt(t,o))),i?null:n.createElement("div",{className:st.a.nameSection},t===Ue?n.createElement("div",{className:st.a.giftLabel},ct("label_pwg_free_gift_label")):null,r))},"PurchaseWithGiftItemCard"),mt=function(e){var t=e.cardType,a=e.itemCards,r=e.maxItemDisplayed,i=e.totalCounts;return a.map(function(e,a){var o=e.id,s=e.image,c=e.name,d=a===r-1&&i>r;return n.createElement(ut,{key:o,cardType:t,image:s,name:c,isMasked:d,itemCounts:pt(i,r)})})},pt=function(e,t){return e&&e-t+1||0},ft=function(e){var t=e.mainItemCards,a=e.giftItemCards,r=e.maxMainItemsDisplayed,i=e.maxGiftItemsDisplayed,o=e.mainCounts,s=e.giftCounts,c=n.useMemo(function(){return[{cardType:je,itemCards:t,maxItemDisplayed:r,totalCounts:o},{cardType:Ue,itemCards:a,maxItemDisplayed:i,totalCounts:s}]},[t,r,o,a,i,s]);return n.createElement("div",{className:st.a.content},c.reduce(function(e,t,a){var r=t.cardType,i=t.itemCards,o=t.maxItemDisplayed,s=t.totalCounts,d=n.createElement("div",{className:st.a.frame,key:r},mt({cardType:r,itemCards:i,maxItemDisplayed:o,totalCounts:s})),l=n.createElement("div",{className:st.a.separator,key:r+" separator"},"+");return a!==c.length-1?[].concat(e,[d,l]):[].concat(e,[d])},[]))},_t=a(3370),vt=a.n(_t),ht=function(e){var t=e.url,a=e.mainItemCards,r=e.giftItemCards,i=e.maxMainItemsDisplayed,o=e.maxGiftItemsDisplayed,s=e.mainCounts,c=e.giftCounts,d=e.minSpend,l=e.giftCount;return n.createElement(K.a,{to:t,className:vt.a.link},n.createElement(it,{minSpend:d,giftCount:l}),n.createElement(ft,{mainItemCards:a,giftItemCards:r,maxMainItemsDisplayed:i,maxGiftItemsDisplayed:o,mainCounts:s,giftCounts:c}))},Et=a(937);function gt(){return(gt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var bt=function(e){var t=e&&e.data&&e.data.main_items;return t||[]},St=function(e){var t=e&&e.data&&e.data.sub_items_raw;return t||[]},It=function(e){var t=e&&e.data&&e.data.item_details;return t||[]},Ot=function(e){return e&&0!==e.length?e.filter(function(e){return 1===e.status&&e.add_on_main_item.status===Le.b.NORMAL&&e.stock>0}):[]},Ct=function(e){return e&&e.stock>0&&1===e.status},yt=function(e){return e&&0!==e.length?e.filter(function(e){return e.status===Le.b.NORMAL&&(e.modelid&&e.modelDetail?Ct(e.modelDetail)&&e.itemDetail&&Ct(e.itemDetail):e.itemDetail&&Ct(e.itemDetail))}):[]},Dt=function(e){return function(t){var a={};t.forEach(function(e){var t=e.itemid;a[t]=e});var n=[];return e.forEach(function(e){var t=gt({},e),r=e.itemid,i=e.modelid,o=a[r];if(o&&(t=gt({},t,{itemDetail:o})),i&&o){var s=o.models;if(s&&s.length>0){var c=s.filter(function(e){return e.modelid===i});c&&c[0]&&(t=gt({},t,{modelDetail:c})),t.modelDetail=c&&c[0]}}n.push(t)}),n}},At=a(3371),Tt=a.n(At),kt=se.a,xt=a(1301)("./"+kt+"-plus.png"),Nt=function(e,t,a){return e&&0!==e.length?e.slice(0,t).map(function(e){var t=e.is_adult&&!a;return{id:""+e.itemid,image:t?xt:Object(y.e)(e.image,!0),name:e.name}}):[]},wt=function(e,t,a){return e&&0!==e.length?e.slice(0,t).reduce(function(e,t){var n=t.itemDetail;if(!n)return e;var r=n.is_adult&&!a;return[].concat(e,[{id:""+n.itemid+(t.modelid||""),image:r?xt:Object(y.e)(n.image,!0),name:n.name}])},[]):[]},Pt=function(e,t){return e&&e.length>0&&t&&t.length>0},Lt=function(e){var t=e.addOnDealId,a=e.addOnDealStore,r=e.itemId,i=e.userIsAdult,o=n.useMemo(function(){return function(e){return Object(s.d)(function(e){return function(t){return t&&e?t.sort(function(t,a){return a.itemid===e?1:-1}):[]}}(e),Ot,bt)}(r)(a)},[r,a]),c=n.useMemo(function(){return e=a,Object(s.d)(yt,Object(s.d)(Object(s.d)(Dt,St)(e),It))(e);var e},[a]),d=n.useMemo(function(){return Nt(o,2,i)},[o,i]),l=n.useMemo(function(){return wt(c,4,i)},[c,i]),u=Et.a.getUrl({dealId:t,itemId:r}),m=a&&a.data;return Pt(o,c)?n.createElement("section",{className:Tt.a.section},n.createElement(ht,{mainItemCards:d,giftItemCards:l,mainCounts:o.length,giftCounts:c.length,maxMainItemsDisplayed:2,maxGiftItemsDisplayed:4,url:u,minSpend:m&&m.purchase_min_spend?m.purchase_min_spend:0,giftCount:m&&m.per_gift_num?m.per_gift_num:0})):null},jt=function(e){return e.addonDeal},Ut=function(e,t,a){return!a||!(e&&e.add_on_deal_info)||!(t&&t.data&&t.data.status===Le.b.NORMAL)},Ft=Object(d.c)(Object(c.connect)(function(e){return{isPwgEnabled:Object(b.isFeatureEnabledForUser)(e.featureToggles,g.F)}},{fetchAddOnDeal:Le.f})(function(e){var t=e.item,a=e.addOnDealId,r=e.injectAsyncReducer,i=e.userIsAdult,o=e.isPwgEnabled,s=e.fetchAddOnDeal;n.useEffect(function(){var e;r(((e={}).addonDeal=Le.l,e))},[r]),n.useEffect(function(){s({add_on_deal_id:a,need_item_info:!0,main_itemids:void 0})},[s,a,t.itemid]);var d=Object(c.useSelector)(jt);return n.useMemo(function(){return Ut(t,d,o)},[t,d,o])?null:n.createElement(Lt,{addOnDealId:a,addOnDealStore:d,itemId:t.itemid,userIsAdult:i})})),Rt=a(335),Mt=a(5),Bt=a(905);t.default=Object(Mt.withI18nCollections)([35,Bt.a])(function(e){var t=e.item,a=e.shopInfo,r=e.userAccount,i=e.requireUserToLogin,o=e.chatWithShop,s=t.add_on_deal_info&&t.add_on_deal_info.sub_type||Le.a.DEFAULT,c=t&&t.add_on_deal_info&&t.add_on_deal_info.add_on_deal_id||0,d=Object(Rt.a)(r,se.a,__LOCALE__);return s===Le.a.GIFT?n.createElement(Ft,{addOnDealId:c,item:t,userIsAdult:d.isUserAdult}):t&&t.stock>0?n.createElement(Ze,{userAccount:r,requireUserToLogin:i,item:t,chatWithShop:o,shopInfo:a}):null})}}]);
//# sourceMappingURL=https://shopee.sg/assets/PageProductAddOnDeals.712e43eaeaeea736d22b.js.map